[dotenv@17.2.3] injecting env (0) from .env.local -- tip: âš™ï¸  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (15) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
ğŸš€ Starting avatar regeneration with improved quality...
ğŸ“¦ Settings:
   - Model: gpt-image-1
   - Output size: 1024x1024
   - Quality: high
   - Reference images: All students with existing photos
   - Max students: All
   - Student filter: All students
   - Dry run: No

ğŸ“¥ Fetching students from database...

âœ… Found 48 students

ğŸ“‹ Students to process:
   - With reference images: 48
   - Without reference images: 0

ğŸ“¸ Students with reference images (will use for identity consistency):
   1. Aiden Wong (S050039) - male, Singaporean
   2. Alice Wong (S050108) - female, Singaporean
   3. Aria Tay (S050046) - female, Singaporean
   4. Arjun Kumar (S2025033) - male, Singapore
   5. Ava Sim (S050054) - female, Singaporean
   6. Caleb Soh (S050045) - male, Singaporean
   7. Chen Jia Yi (S050104) - female, Singaporean
   8. Chen Mei Ling (ADM2020006) - female, Singaporean
   9. Chloe Tan (S050038) - female, Singaporean
   10. Chua Li Hua (ADM2020010) - female, Singaporean
   11. Ella Ng (S050050) - female, Singaporean
   12. Eric Lim (S050101) - male, Singaporean
   13. Ethan Seah (S050033) - male, Singaporean
   14. Goh Rui En (ADM2020009) - male, Singaporean
   15. Hannah Lim (S050042) - female, Singaporean
   16. Harper Koh (S050032) - female, Singaporean
   17. Isaac Yap (S050037) - male, Singaporean
   18. Isabelle Chia (S050040) - female, Singaporean
   19. Jayden Ong (S050047) - male, Singaporean
   20. Koh Zhi Hao (ADM2020007) - male, Singaporean
   21. Layla Koh (S050052) - female, Singaporean
   22. Lee Hui Min (ADM2020002) - female, Singaporean
   23. Liam Tan (S050049) - male, Singaporean
   24. Lim Hui Ling (S050102) - female, Singaporean
   25. Lim Kai Wen (ADM2020003) - male, Singaporean
   26. Lucas Neo (S050041) - male, Singaporean
   27. Mason Lee (S050051) - male, Singaporean
   28. Maya Chen (S2025032) - female, Singapore
   29. Maya Kumar (S050036) - female, Singaporean
   30. Mila Chen (S050048) - female, Singaporean
   31. Muhammad Iskandar (S050106) - male, Singaporean
   32. Ng Xin Yi (ADM2020004) - female, Singaporean
   33. Nicholas Loh (S050105) - male, Singaporean
   34. Noah Phua (S050043) - male, Singaporean
   35. Oliver Ho (S050053) - male, Singaporean
   36. Ong Jun Wei (ADM2020005) - male, Singaporean
   37. Priya Krishnan (S050109) - female, Singaporean
   38. Reza Halim (S050110) - male, Singaporean
   39. Ryan Goh (S050035) - male, Singaporean
   40. Ryan Tan (S050112) - male, Singaporean
   41. Siti Nurul Ain (S050103) - female, Singaporean
   42. Sofia Rahman (S050044) - female, Singaporean
   43. Sofia Tan (S2025034) - female, Singapore
   44. Tan Wei Jie (S050107) - male, Singaporean
   45. Teo Yi Ting (ADM2020008) - female, Singaporean
   46. Wong Kai Xuan (S050111) - male, Singaporean
   47. Zachary Wee (S050055) - male, Singaporean
   48. Zara Begum (S050034) - female, Singaporean


ğŸ’° Estimated cost: $1.92 (48 Ã— $0.04)
â±ï¸  Estimated time: ~2 minutes


[1/48] Processing Aiden Wong...

ğŸ¨ Generating avatar for Aiden Wong (S050039)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: male, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
â±ï¸  Generated in 41246ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1756.03 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/85a5d345-d42d-43e0-b2da-6147353b73ac-1762300372359.png
â³ Waiting 2 seconds before next generation...

[2/48] Processing Alice Wong...

ğŸ¨ Generating avatar for Alice Wong (S050108)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: female, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
â±ï¸  Generated in 50225ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1695.87 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/00ecfa23-d7de-4a72-94bc-fa23d02fe1f1-1762300428106.png
â³ Waiting 2 seconds before next generation...

[3/48] Processing Aria Tay...

ğŸ¨ Generating avatar for Aria Tay (S050046)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: female, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
â±ï¸  Generated in 55531ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1805.49 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/8768bd30-201f-4f8c-8a18-8ed767f550c9-1762300487866.png
â³ Waiting 2 seconds before next generation...

[4/48] Processing Arjun Kumar...

ğŸ¨ Generating avatar for Arjun Kumar (S2025033)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: male, Ethnicity: Singapore, Age: 15, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
â±ï¸  Generated in 43610ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1641.22 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/7666a7af-b726-4885-a9ba-6f67fe624d0a-1762300536883.png
â³ Waiting 2 seconds before next generation...

[5/48] Processing Ava Sim...

ğŸ¨ Generating avatar for Ava Sim (S050054)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: female, Ethnicity: Singaporean, Age: 10, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
â±ï¸  Generated in 54155ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1595.48 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/190d5415-0bbe-445a-955c-729720ebe119-1762300595775.png
â³ Waiting 2 seconds before next generation...

[6/48] Processing Caleb Soh...

ğŸ¨ Generating avatar for Caleb Soh (S050045)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: male, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
â±ï¸  Generated in 43257ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1695.45 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/7dbafc41-8ea1-4a69-b173-4c88b215bda3-1762300643881.png
â³ Waiting 2 seconds before next generation...

[7/48] Processing Chen Jia Yi...

ğŸ¨ Generating avatar for Chen Jia Yi (S050104)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: female, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
5032) - female, Singapore
   29. Maya Kumar (S050036) - female, Singaporean
   30. Mila Chen (S050048) - female, Singaporean
   31. Muhammad Iskandar (S050106) - male, Singaporean
   32. Ng Xin Yi (ADM2020004) - female, Singaporean
   33. Nicholas Loh (S050105) - male, Singaporean
   34. Noah Phua (S050043) - male, Singaporean
   35. Oliver Ho (S050053) - male, Singaporean
   36. Ong Jun Wei (ADM2020005) - male, Singaporean
   37. Priya Krishnan (S050109) - female, Singaporean
   38. Reza Halim (S050110) - male, Singaporean
   39. Ryan Goh (S050035) - male, Singaporean
   40. Ryan Tan (S050112) - male, Singaporean
   41. Siti Nurul Ain (S050103) - female, Singaporean
   42. Sofia Rahman (S050044) - female, Singaporean
   43. Sofia Tan (S2025034) - female, Singapore
   44. Tan Wei Jie (S050107) - male, Singaporean
   45. Teo Yi Ting (ADM2020008) - female, Singaporean
   46. Wong Kai Xuan (S050111) - male, Singaporean
   47. Zachary Wee (S050055) - male, Singaporean
   48. Zara Begum (S050034) - female, Singaporean


ğŸ’° Estimated cost: $1.92 (48 Ã— $0.04)
â±ï¸  Estimated time: ~2 minutes


[1/48] Processing Aiden Wong...

ğŸ¨ Generating avatar for Aiden Wong (S050039)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: male, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
   âš ï¸  Responses API not available, falling back to Images API...
â±ï¸  Generated in 37989ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1701.19 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/85a5d345-d42d-43e0-b2da-6147353b73ac-1762300532990.png
â³ Waiting 2 seconds before next generation...

[2/48] Processing Alice Wong...

ğŸ¨ Generating avatar for Alice Wong (S050108)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: female, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
   âš ï¸  Responses API not available, falling back to Images API...
â±ï¸  Generated in 50138ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1689.43 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/00ecfa23-d7de-4a72-94bc-fa23d02fe1f1-1762300588751.png
â³ Waiting 2 seconds before next generation...

[3/48] Processing Aria Tay...

ğŸ¨ Generating avatar for Aria Tay (S050046)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: female, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
   âš ï¸  Responses API not available, falling back to Images API...
âŒ Error generating avatar for Aria Tay: BadRequestError: 400 Your request was rejected by the safety system. If you believe this is an error, contact us at help.openai.com and include the request ID req_f8fe38355b734500876176701a304c70.
    at APIError.generate (/Users/rezailmi/Documents/GitHub/moe-tg-vx/node_modules/openai/src/core/error.ts:72:14)
    at OpenAI.makeStatusError (/Users/rezailmi/Documents/GitHub/moe-tg-vx/node_modules/openai/src/client.ts:478:28)
    at OpenAI.makeRequest (/Users/rezailmi/Documents/GitHub/moe-tg-vx/node_modules/openai/src/client.ts:728:24)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async generateAndSaveAvatar (/Users/rezailmi/Documents/GitHub/moe-tg-vx/scripts/regenerate-all-avatars.ts:170:20)
    at async main (/Users/rezailmi/Documents/GitHub/moe-tg-vx/scripts/regenerate-all-avatars.ts:406:7) {
  status: 400,
  headers: Headers {
    date: 'Tue, 04 Nov 2025 23:57:25 GMT',
    'content-type': 'application/json',
    'content-length': '309',
    connection: 'keep-alive',
    'openai-version': '2020-10-01',
    'openai-organization': 'personal-idbsx9',
    'openai-project': 'proj_eeAATzcg6kc2KYDUhwFnXZoP',
    'x-request-id': 'req_f8fe38355b734500876176701a304c70',
    'openai-processing-ms': '51236',
    'x-envoy-upstream-service-time': '51238',
    'cf-cache-status': 'DYNAMIC',
    'set-cookie': '__cf_bm=LiKUdvtCRP4IOSIhhvNyJdPTDGNFzAgk9rKlVFvmVR0-1762300645-1.0.1.1-eujd8TQpNy32LVUCOfN222S7wLLx3zpSkdCmAR1ryJut0I7iJzV4S9b38.oNqd0mpqmywguFTP9gUfZmMn17lBzyEUH2VcZ6FKMxaUMNFbU; path=/; expires=Wed, 05-Nov-25 00:27:25 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=HSdeZJROulgSv2J7GjSXhxnk37N4jzhxtV3OKlZ6wU8-1762300645537-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',
    'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',
    'x-content-type-options': 'nosniff',
    server: 'cloudflare',
    'cf-ray': '99980c78cbfd4b6d-SIN',
    'alt-svc': 'h3=":443"; ma=86400'
  },
  requestID: 'req_f8fe38355b734500876176701a304c70',
  error: {
    message: 'Your request was rejected by the safety system. If you believe this is an error, contact us at help.openai.com and include the request ID req_f8fe38355b734500876176701a304c70.',
    type: 'image_generation_user_error',
    param: null,
    code: 'moderation_blocked'
  },
  code: 'moderation_blocked',
  param: null,
  type: 'image_generation_user_error'
}
Failed to generate avatar for Aria Tay

[4/48] Processing Arjun Kumar...

ğŸ¨ Generating avatar for Arjun Kumar (S2025033)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: male, Ethnicity: Singapore, Age: 15, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
   âš ï¸  Responses API not available, falling back to Images API...
[dotenv@17.2.3] injecting env (0) from .env.local -- tip: âš™ï¸  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (15) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
ğŸš€ Starting avatar regeneration with improved quality...
ğŸ“¦ Settings:
   - Model: gpt-image-1
   - Output size: 1024x1024
   - Quality: high
   - Reference images: All students with existing photos
   - Max students: All
   - Student filter: All students
   - Dry run: No

ğŸ“¥ Fetching students from database...

âœ… Found 48 students

ğŸ“‹ Students to process:
   - With reference images: 48
   - Without reference images: 0

ğŸ“¸ Students with reference images (will use for identity consistency):
   1. Aiden Wong (S050039) - male, Singaporean
   2. Alice Wong (S050108) - female, Singaporean
   3. Aria Tay (S050046) - female, Singaporean
   4. Arjun Kumar (S2025033) - male, Singapore
   5. Ava Sim (S050054) - female, Singaporean
   6. Caleb Soh (S050045) - male, Singaporean
   7. Chen Jia Yi (S050104) - female, Singaporean
   8. Chen Mei Ling (ADM2020006) - female, Singaporean
   9. Chloe Tan (S050038) - female, Singaporean
   10. Chua Li Hua (ADM2020010) - female, Singaporean
   11. Ella Ng (S050050) - female, Singaporean
   12. Eric Lim (S050101) - male, Singaporean
   13. Ethan Seah (S050033) - male, Singaporean
   14. Goh Rui En (ADM2020009) - male, Singaporean
   15. Hannah Lim (S050042) - female, Singaporean
   16. Harper Koh (S050032) - female, Singaporean
   17. Isaac Yap (S050037) - male, Singaporean
   18. Isabelle Chia (S050040) - female, Singaporean
   19. Jayden Ong (S050047) - male, Singaporean
   20. Koh Zhi Hao (ADM2020007) - male, Singaporean
   21. Layla Koh (S050052) - female, Singaporean
   22. Lee Hui Min (ADM2020002) - female, Singaporean
   23. Liam Tan (S050049) - male, Singaporean
   24. Lim Hui Ling (S050102) - female, Singaporean
   25. Lim Kai Wen (ADM2020003) - male, Singaporean
   26. Lucas Neo (S050041) - male, Singaporean
   27. Mason Lee (S050051) - male, Singaporean
   28. Maya Chen (S2025032) - female, Singapore
   29. Maya Kumar (S050036) - female, Singaporean
   30. Mila Chen (S050048) - female, Singaporean
   31. Muhammad Iskandar (S050106) - male, Singaporean
   32. Ng Xin Yi (ADM2020004) - female, Singaporean
   33. Nicholas Loh (S050105) - male, Singaporean
   34. Noah Phua (S050043) - male, Singaporean
   35. Oliver Ho (S050053) - male, Singaporean
   36. Ong Jun Wei (ADM2020005) - male, Singaporean
   37. Priya Krishnan (S050109) - female, Singaporean
   38. Reza Halim (S050110) - male, Singaporean
   39. Ryan Goh (S050035) - male, Singaporean
   40. Ryan Tan (S050112) - male, Singaporean
   41. Siti Nurul Ain (S050103) - female, Singaporean
   42. Sofia Rahman (S050044) - female, Singaporean
   43. Sofia Tan (S2025034) - female, Singapore
   44. Tan Wei Jie (S050107) - male, Singaporean
   45. Teo Yi Ting (ADM2020008) - female, Singaporean
   46. Wong Kai Xuan (S050111) - male, Singaporean
   47. Zachary Wee (S050055) - male, Singaporean
   48. Zara Begum (S050034) - female, Singaporean


ğŸ’° Estimated cost: $1.92 (48 Ã— $0.04)
â±ï¸  Estimated time: ~2 minutes


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š Progress: 1/48 (2%) | â±ï¸  0.0m elapsed | ETA: ?m
âœ… Success: 0 | âŒ Failed: 0
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘¤ Processing: Aiden Wong (S050039)

ğŸ¨ Generating avatar for Aiden Wong (S050039)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: male, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
   âš ï¸  Responses API not available, falling back to Images API...
â±ï¸  Generated in 42106ms
ğŸ”— Image received as base64 payload
ğŸ§© Decoding base64 image...
â˜ï¸  Uploading to Supabase Storage...
ğŸ’¾ Updating student record...
âœ… Successfully generated and saved avatar
ğŸ“Š File size: 1732.20 KB
ğŸ”— URL: https://uzrzyapgxseqqisapmzb.supabase.co/storage/v1/object/public/student-photos/85a5d345-d42d-43e0-b2da-6147353b73ac-1762300701007.png

â³ Waiting 2 seconds before next generation...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š Progress: 2/48 (4%) | â±ï¸  0.8m elapsed | ETA: 37.3m
âœ… Success: 1 | âŒ Failed: 0
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘¤ Processing: Alice Wong (S050108)

ğŸ¨ Generating avatar for Alice Wong (S050108)...
   ğŸ“¸ Using reference image for identity consistency
ğŸ“ Gender: female, Ethnicity: Singaporean, Age: 11, Size: 1024x1024
   ğŸ”„ Using Responses API with reference image...
   âš ï¸  Responses API not available, falling back to Images API...
